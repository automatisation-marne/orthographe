<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Conjuguer "aller" - CE1</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    #consigne { font-size: 20px; margin-bottom: 20px; }
    #phrase { font-size: 24px; margin: 20px; }
    #clavier { display: flex; flex-wrap: wrap; max-width: 400px; margin: 20px auto; }
    .touche {
      width: 40px; height: 40px; margin: 4px;
      font-size: 20px; text-align: center; line-height: 40px;
      background: #eee; border: 1px solid #ccc; cursor: pointer;
    }
    #inputZone {
      font-size: 24px; padding: 5px; width: 200px; text-align: center;
      margin: 10px auto; border: 2px solid #888;
    }
    button { padding: 10px 20px; font-size: 18px; margin: 10px; }
    .valider { background-color: #4CAF50; color: white; }
    .terminer { background-color: #f44336; color: white; }
    #feedback { font-size: 20px; margin-top: 10px; }
  </style>
</head>
<body>
  <div id="consigne">Conjugue le verbe <b>aller</b> à la bonne personne pour compléter la phrase.</div>
  <div id="phrase"></div>
  <div><input type="text" id="inputZone" readonly /></div>

  <div id="clavier"></div>

  <button class="valider" onclick="valider()">Valider</button>
  <button id="suivantBtn" onclick="suivant()" style="display:none">Phrase suivante</button>
  <button class="terminer" onclick="confirmerFin()">Terminer l'exercice</button>

  <div id="feedback"></div>
  <div id="score"></div>

<script>

const phrases = [
  "Je __ un gâteau pour l'anniversaire.|préparerai",
  "Tu __ la table pour le dîner.|mettras",
  "Il __ une lettre à sa grand-mère.|écrira",
  "Nous __ une chanson ensemble.|chanterons",
  "Vous __ un château de sable.|construirez",
  "Elles __ un joli dessin.|dessineront",
  "Mon frère __ son vélo.|lavera",
  "Les enfants __ dans la cour.|joueront",
  "Ma sœur et moi __ un film.|regarderons",
  "Tu __ ton cartable.|prépareras",
  "Il __ le ballon très fort.|lancera",
  "Nous __ la pièce de théâtre.|répéterons",
  "Vous __ la maison.|nettoierez",
  "Je __ mon cahier.|ouvrirai",
  "Ils __ dans le jardin.|travailleront",
  "Elle __ son livre préféré.|lira",
  "Tu __ un message.|enverras",
  "Nous __ les plantes.|arroserons",
  "Vous __ au professeur.|répondrez",
  "Elles __ leurs affaires.|rangeront"
];


let index = 0;
let bonnes = 0;
let total = 0;
let aDéjàRéponduJuste = false;




function melanger(tab) {
  for (let i = tab.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [tab[i], tab[j]] = [tab[j], tab[i]];
  }
  return tab;
}

let phrasesMelangées = melanger([...phrases]);

function afficherPhrase() {
  aDéjàRéponduJuste = false;
aDéjàTenté = false;
  document.getElementById("inputZone").value = "";
  document.getElementById("feedback").innerText = "";
  document.getElementById("suivantBtn").style.display = "none";
  const [texte] = phrasesMelangées[index].split("|");
  document.getElementById("phrase").innerText = texte.replace("__", "_____");
}

function valider() {
  const [_, reponse] = phrasesMelangées[index].split("|");
  const saisie = document.getElementById("inputZone").value.trim().toLowerCase();

  if (saisie === reponse) {
    document.getElementById("feedback").innerText = "Bravo, bonne réponse !";
    if (!aDéjàRéponduJuste) {
      bonnes++;
      total++;
      aDéjàRéponduJuste = true;
    }
    document.getElementById("suivantBtn").style.display = "inline-block";
  } else {
    document.getElementById("feedback").innerText = "Essaie encore.";
  }
}



function suivant() {
  if (index < phrasesMelangées.length - 1) {
    index++;
    afficherPhrase();
  } else {
    confirmerFin();
  }
}

function confirmerFin() {
  if (confirm("Attention, si tu cliques ici, l'exercice sera terminé et tu ne pourras plus écrire de phrases.")) {
    terminer();
  }
}

function terminer() {
  document.getElementById("score").innerText = "";
  document.getElementById("phrase").innerText = "L'exercice est terminé.";
  document.getElementById("clavier").style.display = "none";
  document.getElementById("inputZone").style.display = "none";
  document.getElementById("suivantBtn").style.display = "none";
  const restartBtn = document.createElement("button");
  restartBtn.innerText = "Recommencer l'exercice";
  restartBtn.onclick = () => location.reload();
  restartBtn.style.marginTop = "20px";
  document.body.appendChild(restartBtn);
}



function appuyer(touche) {
  document.getElementById("inputZone").value += touche;
}

function creerClavier() {
  const lettres = [
    'a','b','c','d','e','f','g','h','i','j',
    'k','l','m','n','o','p','q','r','s','t',
    'u','v','w','x','y','z',
    'à','é','è','ê','ù',
    '<',' '
  ];
  const clavier = document.getElementById("clavier");
  lettres.forEach(t => {
    let btn = document.createElement("div");
    btn.className = "touche";
    btn.innerText = t;
    btn.onclick = () => {
      if (t === '<') {
        let zone = document.getElementById("inputZone");
        zone.value = zone.value.slice(0, -1);
      } else {
        appuyer(t);
      }
    };
    clavier.appendChild(btn);
  });
}

window.onload = function() {
  creerClavier();
  afficherPhrase();
};

</script>
</body>
</html>
